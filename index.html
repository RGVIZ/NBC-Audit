<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Planner Decision Matrix</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
    <!-- Load React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root">
        <!-- React app will render here -->
    </div>

    <!-- The React/JSX code goes here, compiled by Babel -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Global Data and Utility Functions ---

        // Initial state for the Decision Matrix items
        const initialMatrixData = [
          { id: 1, process: 'Procurement Process', department: 'Finance', inherentRisk: 4, controlEffectiveness: 2, timeSinceAudit: 1, auditCount: 0 },
          { id: 2, process: 'Data Privacy Compliance', department: 'Legal', inherentRisk: 5, controlEffectiveness: 3, timeSinceAudit: 0, auditCount: 0 },
          { id: 3, process: 'Employee Onboarding', department: 'HR', inherentRisk: 2, controlEffectiveness: 4, timeSinceAudit: 3, auditCount: 0 },
        ];

        /**
         * Calculates the required audit count based on risk factors.
         */
        const calculateAuditCount = (item) => {
          // Normalize control effectiveness: 1 (High effectiveness) -> 5 (Low effectiveness)
          const normalizedControl = 6 - item.controlEffectiveness;
          
          // Calculate raw risk score
          const riskScore = (item.inherentRisk * normalizedControl) + item.timeSinceAudit;

          if (riskScore >= 21) return 4;
          if (riskScore >= 16) return 3;
          if (riskScore >= 11) return 2;
          if (riskScore >= 6) return 1;
          return 0;
        };


        // --- SVG Icons ---

        const CheckSquareIcon = (props = { size: 32, color: 'currentColor', classes: '' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke={props.color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.classes}>
            <polyline points="9 11 12 14 22 4"></polyline>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
        );

        const SlidersIcon = (props = { size: 20, color: 'currentColor', classes: '' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke={props.color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.classes}>
            <line x1="4" x2="4" y1="21" y2="14"></line><line x1="4" x2="4" y1="10" y2="3"></line><line x1="12" x2="12" y1="21" y2="12"></line><line x1="12" x2="12" y1="8" y2="3"></line><line x1="20" x2="20" y1="21" y2="16"></line><line x1="20" x2="20" y1="12" y2="3"></line><line x1="1" x2="7" y1="14" y2="14"></line><line x1="9" x2="15" y1="12" y2="12"></line><line x1="17" x2="23" y1="16" y2="16"></line>
          </svg>
        );

        const CalendarIcon = (props = { size: 20, color: 'currentColor', classes: '' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke={props.color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.classes}>
            <path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path>
          </svg>
        );

        const SettingsIcon = (props = { size: 20, color: 'currentColor', classes: '' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke={props.color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.classes}>
            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.19a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.23.46a2 2 0 0 0 .73 2.73l.15.08a2 2 0 0 1 1 1.73v.53a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.23.46a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.19a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.23-.46a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.52a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.23-.46a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        );


        // Navigation button helper component
        const NavButton = ({ page, currentPage, setCurrentPage, icon, label }) => {
          const isActive = currentPage === page;
          const baseClasses = "flex items-center w-full p-3 rounded-xl transition-all duration-200";
          const activeClasses = "bg-indigo-600 shadow-lg text-white";
          const inactiveClasses = "text-indigo-200 hover:bg-indigo-700/50 hover:text-white";

          return (
            <button
              onClick={() => setCurrentPage(page)}
              className={`${baseClasses} ${isActive ? activeClasses : inactiveClasses}`}
            >
              {icon}
              <span className="font-medium">{label}</span>
            </button>
          );
        };

        // Mobile navigation button helper component
        const MobileNavButton = ({ page, currentPage, setCurrentPage, icon, label }) => {
          const isActive = currentPage === page;
          const baseClasses = "flex-1 flex justify-center items-center py-2 px-3 text-sm font-semibold rounded-lg transition-all";
          const activeClasses = "bg-indigo-600 text-white";
          const inactiveClasses = "bg-gray-200 text-gray-700 hover:bg-gray-300";

          return (
            <button
              onClick={() => setCurrentPage(page)}
              className={`${baseClasses} ${isActive ? activeClasses : inactiveClasses}`}
            >
              {icon} {label}
            </button>
          );
        };

        // --- Sub-Components for Decision Matrix ---

        /**
         * Component for the interactive table in the Decision Matrix view.
         */
        const DecisionMatrix = ({ matrixData, setMatrixData }) => {

          // Update the data when an input field changes
          const handleInputChange = (id, field, value) => {
            setMatrixData(prevData =>
              prevData.map(item => {
                if (item.id === id) {
                  const updatedItem = { ...item, [field]: Number(value) };
                  updatedItem.auditCount = calculateAuditCount(updatedItem);
                  return updatedItem;
                }
                return item;
              })
            );
          };

          // Add a new row to the matrix
          const addRow = () => {
            // Math.max can return -Infinity on an empty array, so ensure a default value of 0.
            const maxId = matrixData.length > 0 ? Math.max(...matrixData.map(i => i.id)) : 0;
            const newId = maxId + 1;
            
            const newItem = {
              id: newId,
              process: 'New Process/Function',
              department: 'N/A',
              inherentRisk: 3,
              controlEffectiveness: 3,
              timeSinceAudit: 0,
              auditCount: calculateAuditCount({ inherentRisk: 3, controlEffectiveness: 3, timeSinceAudit: 0 })
            };
            setMatrixData([...matrixData, newItem]);
          };

          // Delete a row
          const deleteRow = (id) => {
            setMatrixData(matrixData.filter(item => item.id !== id));
          };

          const getCountColor = (count) => {
            if (count >= 3) return 'bg-red-500 text-white';
            if (count === 2) return 'bg-orange-500 text-white';
            if (count === 1) return 'bg-yellow-400 text-gray-800';
            return 'bg-green-500 text-white';
          }

          return (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-3xl font-bold text-gray-800 flex items-center">
                  <SlidersIcon size={24} color="currentColor" classes="w-6 h-6 mr-3 text-indigo-600" />
                  Audit Decision Matrix
                </h2>
                <button
                  onClick={addRow}
                  className="px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 flex items-center"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Add Auditable Item
                </button>
              </div>
              <p className="text-gray-600 border-b pb-4">
                Input the risk factors for each process. The **Required Audit Count** is automatically calculated based on the combined risk score.
              </p>

              {/* Responsive Table Layout */}
              <div className="overflow-x-auto bg-white rounded-xl shadow-lg">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5">Process/Function</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5">Department</th>
                      <th className="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Inherent Risk (1-5)</th>
                      <th className="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Control Effectiveness (1-5)</th>
                      <th className="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Time Since Audit (Years)</th>
                      <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Required Audit Count</th>
                      <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-12">Action</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {matrixData.map(item => (
                      <tr key={item.id} className="hover:bg-gray-50 transition duration-100">
                        
                        {/* Process Name */}
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                          {item.process}
                        </td>

                        {/* Department */}
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          {item.department}
                        </td>

                        {/* Inherent Risk Input */}
                        <td className="px-3 py-4 whitespace-nowrap">
                          <input
                            type="number"
                            min="1"
                            max="5"
                            value={item.inherentRisk}
                            onChange={(e) => handleInputChange(item.id, 'inherentRisk', e.target.value)}
                            className="w-full text-center border border-gray-300 rounded-lg p-2 text-sm focus:ring-indigo-500 focus:border-indigo-500"
                          />
                        </td>

                        {/* Control Effectiveness Input */}
                        <td className="px-3 py-4 whitespace-nowrap">
                          <input
                            type="number"
                            min="1"
                            max="5"
                            value={item.controlEffectiveness}
                            onChange={(e) => handleInputChange(item.id, 'controlEffectiveness', e.target.value)}
                            className="w-full text-center border border-gray-300 rounded-lg p-2 text-sm focus:ring-indigo-500 focus:border-indigo-500"
                          />
                        </td>

                        {/* Time Since Audit Input */}
                        <td className="px-3 py-4 whitespace-nowrap">
                          <input
                            type="number"
                            min="0"
                            max="5"
                            value={item.timeSinceAudit}
                            onChange={(e) => handleInputChange(item.id, 'timeSinceAudit', e.target.value)}
                            className="w-full text-center border border-gray-300 rounded-lg p-2 text-sm focus:ring-indigo-500 focus:border-indigo-500"
                          />
                        </td>

                        {/* Audit Count Output */}
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className={`p-2 rounded-full text-center font-bold text-sm mx-auto w-10 ${getCountColor(item.auditCount)}`}>
                            {item.auditCount}
                          </div>
                        </td>

                        {/* Delete Button */}
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <button
                            onClick={() => deleteRow(item.id)}
                            className="text-red-600 hover:text-red-900 transition duration-150 p-1 rounded-full hover:bg-red-100"
                            title="Remove Item"
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          );
        };


        // Main application component
        const App = () => {
          const [currentPage, setCurrentPage] = useState('decisionMatrix');
          // Initialize data with calculated audit counts
          const [matrixData, setMatrixData] = useState(initialMatrixData.map(item => ({
            ...item,
            auditCount: calculateAuditCount(item)
          }))); 
          
          // --- Dynamic Content Rendering ---

          const renderContent = () => {
            switch (currentPage) {
              case 'decisionMatrix':
                return (
                  <div className="p-6 h-full overflow-y-auto">
                    <DecisionMatrix matrixData={matrixData} setMatrixData={setMatrixData} />
                  </div>
                );
              case 'auditSchedule':
                return (
                  <div className="p-6 bg-white rounded-xl shadow-lg h-full overflow-y-auto">
                    <h2 className="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                      <CalendarIcon size={24} color="currentColor" classes="w-6 h-6 mr-3 text-green-600" />
                      Audit Schedule
                    </h2>
                    <p className="text-gray-600 mb-6 border-b pb-4">
                      This section will visualize the audits generated from the Decision Matrix, allowing you to assign auditors and set specific dates for each required audit.
                    </p>
                    <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                      <h3 className="font-semibold text-green-800 mb-2">Audits to Schedule (Based on Matrix):</h3>
                      <ul className="list-disc list-inside text-sm text-green-700 space-y-2">
                        {matrixData
                          .filter(item => item.auditCount > 0)
                          .map(item => (
                            <li key={item.id}>
                              **{item.process}**: Requires **{item.auditCount}** {item.auditCount === 1 ? 'audit' : 'audits'}.
                            </li>
                          ))}
                        {matrixData.every(item => item.auditCount === 0) && (
                          <li>No audits are currently required based on the matrix scoring.</li>
                        )}
                      </ul>
                    </div>
                  </div>
                );
              case 'settings':
                return (
                  <div className="p-6 bg-white rounded-xl shadow-lg h-full overflow-y-auto">
                    <h2 className="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                      <SettingsIcon size={24} color="currentColor" classes="w-6 h-6 mr-3 text-gray-600" />
                      Application Settings
                    </h2>
                    <p className="text-gray-600">Placeholder for global application configuration.</p>
                  </div>
                );
              default:
                return null;
            }
          };

          // --- Main Layout ---

          return (
            <div className="min-h-screen bg-gray-100 flex font-sans antialiased">
              
              {/* 1. Sidebar Navigation (Desktop) */}
              <aside className="w-64 bg-indigo-900 text-white flex-shrink-0 p-4 shadow-2xl hidden md:flex flex-col">
                <div className="flex items-center mb-10 mt-4 px-2">
                  <CheckSquareIcon size={32} color="#9fa8da" classes="mr-3" />
                  <h1 className="text-xl font-extrabold tracking-wider">Audit Planner</h1>
                </div>

                <nav className="space-y-2 flex-grow">
                  <NavButton
                    page="decisionMatrix"
                    currentPage={currentPage}
                    setCurrentPage={setCurrentPage}
                    icon={<SlidersIcon size={20} color="currentColor" classes="w-5 h-5 mr-3" />}
                    label="Audit Decision Matrix"
                  />
                  <NavButton
                    page="auditSchedule"
                    currentPage={currentPage}
                    setCurrentPage={setCurrentPage}
                    icon={<CalendarIcon size={20} color="currentColor" classes="w-5 h-5 mr-3" />}
                    label="Audit Schedule"
                  />
                </nav>

                <div className="border-t border-indigo-700 pt-4 mt-auto">
                  <NavButton
                    page="settings"
                    currentPage={currentPage}
                    setCurrentPage={setCurrentPage}
                    icon={<SettingsIcon size={20} color="currentColor" classes="w-5 h-5 mr-3" />}
                    label="Settings"
                  />
                </div>
              </aside>

              {/* 2. Main Content Area */}
              <main className="flex-grow p-4 md:p-8 overflow-y-auto">
                
                {/* Mobile Header/Navigation (Visible only on small screens) */}
                <header className="md:hidden bg-white p-4 rounded-xl shadow-lg mb-6">
                    <h1 className="text-xl font-bold text-gray-800 mb-3 flex items-center">
                        <CheckSquareIcon size={24} color="currentColor" classes="w-6 h-6 text-indigo-600 mr-2" />
                        Audit Planner
                    </h1>
                    <div className="flex space-x-2">
                        <MobileNavButton
                            page="decisionMatrix"
                            currentPage={currentPage}
                            setCurrentPage={setCurrentPage}
                            icon={<SlidersIcon size={16} color="currentColor" classes="w-4 h-4 mr-1" />}
                            label="Matrix"
                        />
                        <MobileNavButton
                            page="auditSchedule"
                            currentPage={currentPage}
                            setCurrentPage={setCurrentPage}
                            icon={<CalendarIcon size={16} color="currentColor" classes="w-4 h-4 mr-1" />}
                            label="Schedule"
                        />
                    </div>
                </header>

                {/* Dynamic Content */}
                <div className="h-full">
                    {renderContent()}
                </div>
              </main>
            </div>
          );
        };

        // Render the main application component
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
